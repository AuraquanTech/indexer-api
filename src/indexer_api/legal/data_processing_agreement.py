"""
Data Processing Agreement (DPA) for IndexerAPI
GDPR Article 28 compliant processor agreement
Last Updated: January 2026
"""

DATA_PROCESSING_AGREEMENT = """
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Processing Agreement - IndexerAPI</title>
    <style>
        :root { --primary: #00f3ff; --bg: #0a0a0f; --card: #111118; --text: #e0e0e0; --muted: #888; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); line-height: 1.7; padding: 40px 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: var(--primary); font-size: 2.5rem; margin-bottom: 10px; }
        h2 { color: var(--primary); font-size: 1.5rem; margin: 40px 0 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        h3 { color: #fff; font-size: 1.2rem; margin: 25px 0 15px; }
        p, li { margin-bottom: 15px; color: var(--text); }
        ul, ol { padding-left: 25px; }
        .effective-date { color: var(--muted); margin-bottom: 30px; }
        .highlight { background: #1a1a2e; border-left: 3px solid var(--primary); padding: 15px 20px; margin: 20px 0; border-radius: 0 8px 8px 0; }
        .warning { background: #2e1a1a; border-left: 3px solid #ff4444; padding: 15px 20px; margin: 20px 0; border-radius: 0 8px 8px 0; }
        a { color: var(--primary); }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #333; padding: 12px; text-align: left; }
        th { background: #1a1a2e; color: var(--primary); }
        .footer { margin-top: 60px; padding-top: 30px; border-top: 1px solid #333; color: var(--muted); font-size: 0.9rem; }
        .annex { background: #0d0d12; border: 1px solid #333; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .annex h4 { color: var(--primary); margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Data Processing Agreement</h1>
        <p class="effective-date">Effective Date: January 5, 2026 | Version 1.0</p>

        <div class="highlight">
            <strong>Summary:</strong> This Data Processing Agreement ("DPA") forms part of the Terms of Service between Ayrto Engineering and you ("Customer") and governs our processing of personal data on your behalf in compliance with GDPR Article 28.
        </div>

        <h2>1. Definitions</h2>
        <ul>
            <li><strong>"Controller"</strong> means the Customer, who determines the purposes and means of Processing Personal Data.</li>
            <li><strong>"Processor"</strong> means Ayrto Engineering, which Processes Personal Data on behalf of the Controller.</li>
            <li><strong>"Personal Data"</strong> means any information relating to an identified or identifiable natural person.</li>
            <li><strong>"Processing"</strong> means any operation performed on Personal Data, including collection, storage, retrieval, use, and deletion.</li>
            <li><strong>"Data Subject"</strong> means an identifiable natural person whose Personal Data is Processed.</li>
            <li><strong>"Sub-processor"</strong> means any third party engaged by the Processor to Process Personal Data.</li>
            <li><strong>"Supervisory Authority"</strong> means an independent public authority responsible for monitoring GDPR compliance.</li>
            <li><strong>"Data Breach"</strong> means a breach of security leading to accidental or unlawful destruction, loss, alteration, or unauthorized disclosure of Personal Data.</li>
            <li><strong>"Standard Contractual Clauses" or "SCCs"</strong> means the contractual clauses adopted by the European Commission for international data transfers.</li>
        </ul>

        <h2>2. Scope and Application</h2>
        <p>This DPA applies when Ayrto Engineering (Processor) processes Personal Data on behalf of the Customer (Controller) in connection with the IndexerAPI service.</p>
        <p>This DPA is incorporated into and forms part of the Terms of Service. In case of conflict, this DPA shall prevail regarding data protection matters.</p>

        <h2>3. Processing Details</h2>

        <h3>3.1 Subject Matter</h3>
        <p>The Processor shall Process Personal Data solely for the purpose of providing the IndexerAPI service, including:</p>
        <ul>
            <li>File indexing and metadata extraction</li>
            <li>Code analysis and complexity metrics</li>
            <li>Semantic search and embedding generation</li>
            <li>Digital asset management</li>
        </ul>

        <h3>3.2 Duration of Processing</h3>
        <p>Processing shall continue for the duration of the service agreement and shall cease upon termination, subject to applicable retention requirements.</p>

        <h3>3.3 Nature and Purpose</h3>
        <table>
            <tr>
                <th>Aspect</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>Nature</td>
                <td>Automated processing of files and metadata via API</td>
            </tr>
            <tr>
                <td>Purpose</td>
                <td>Provide file indexing, search, and analysis services</td>
            </tr>
            <tr>
                <td>Type of Data</td>
                <td>File metadata, file content, user account data</td>
            </tr>
            <tr>
                <td>Data Subjects</td>
                <td>Customer's end users, employees, or other individuals</td>
            </tr>
        </table>

        <h2>4. Processor Obligations</h2>

        <h3>4.1 General Obligations</h3>
        <p>The Processor shall:</p>
        <ul>
            <li>Process Personal Data only on documented instructions from the Controller</li>
            <li>Ensure persons authorized to process Personal Data are bound by confidentiality obligations</li>
            <li>Implement appropriate technical and organizational security measures</li>
            <li>Respect the conditions for engaging Sub-processors</li>
            <li>Assist the Controller in responding to Data Subject requests</li>
            <li>Assist the Controller in ensuring compliance with security, breach notification, and data protection impact assessment obligations</li>
            <li>Delete or return all Personal Data upon termination, at the Controller's choice</li>
            <li>Make available all information necessary to demonstrate compliance with this DPA</li>
        </ul>

        <h3>4.2 Processing Instructions</h3>
        <p>The Processor shall:</p>
        <ul>
            <li>Process Personal Data only in accordance with the Controller's documented instructions</li>
            <li>Immediately inform the Controller if any instruction infringes applicable data protection laws</li>
            <li>Not process Personal Data for any purpose other than providing the service</li>
        </ul>

        <h3>4.3 Confidentiality</h3>
        <p>The Processor shall ensure that all personnel processing Personal Data:</p>
        <ul>
            <li>Are subject to confidentiality obligations</li>
            <li>Have received appropriate training on data protection requirements</li>
            <li>Process Personal Data only as instructed</li>
        </ul>

        <h2>5. Security Measures</h2>

        <h3>5.1 Technical Measures</h3>
        <p>The Processor implements the following technical security measures:</p>
        <ul>
            <li><strong>Encryption in Transit:</strong> TLS 1.3 for all data transmission</li>
            <li><strong>Encryption at Rest:</strong> AES-256 encryption for stored data</li>
            <li><strong>Access Controls:</strong> Role-based access control with multi-factor authentication</li>
            <li><strong>Password Security:</strong> bcrypt hashing for credential storage</li>
            <li><strong>Network Security:</strong> Firewalls, intrusion detection, and DDoS protection</li>
            <li><strong>Logging:</strong> Comprehensive audit logging of access and changes</li>
        </ul>

        <h3>5.2 Organizational Measures</h3>
        <ul>
            <li><strong>Access Management:</strong> Principle of least privilege for all systems</li>
            <li><strong>Security Training:</strong> Regular security awareness training for staff</li>
            <li><strong>Incident Response:</strong> Documented incident response procedures</li>
            <li><strong>Vendor Management:</strong> Security assessments of all Sub-processors</li>
            <li><strong>Business Continuity:</strong> Regular backups and disaster recovery planning</li>
        </ul>

        <h3>5.3 Security Certification</h3>
        <p>Upon request, the Processor shall provide evidence of security practices, which may include:</p>
        <ul>
            <li>Summary of security audit reports</li>
            <li>Certifications (e.g., SOC 2, ISO 27001) when available</li>
            <li>Results of penetration testing (summary form)</li>
        </ul>

        <h2>6. Sub-processors</h2>

        <h3>6.1 Authorization</h3>
        <p>The Controller provides general authorization for the Processor to engage Sub-processors listed in Annex B. The Processor shall:</p>
        <ul>
            <li>Maintain an up-to-date list of Sub-processors</li>
            <li>Notify the Controller of any intended changes to Sub-processors</li>
            <li>Allow the Controller to object to new Sub-processors</li>
        </ul>

        <h3>6.2 Sub-processor Agreements</h3>
        <p>The Processor shall ensure that Sub-processors are bound by data protection obligations no less protective than those in this DPA.</p>

        <h3>6.3 Objection to Sub-processors</h3>
        <p>If the Controller objects to a new Sub-processor on reasonable grounds related to data protection:</p>
        <ul>
            <li>The parties shall discuss the concerns in good faith</li>
            <li>The Processor shall consider alternatives where feasible</li>
            <li>If no resolution is reached, the Controller may terminate the affected services</li>
        </ul>

        <h2>7. Data Subject Rights</h2>

        <h3>7.1 Assistance with Requests</h3>
        <p>The Processor shall assist the Controller in responding to Data Subject requests including:</p>
        <ul>
            <li>Access to Personal Data</li>
            <li>Rectification of inaccurate data</li>
            <li>Erasure ("right to be forgotten")</li>
            <li>Restriction of processing</li>
            <li>Data portability</li>
            <li>Objection to processing</li>
        </ul>

        <h3>7.2 Direct Requests</h3>
        <p>If the Processor receives a request directly from a Data Subject:</p>
        <ul>
            <li>The Processor shall promptly notify the Controller</li>
            <li>The Processor shall not respond directly unless authorized by the Controller or required by law</li>
        </ul>

        <h2>8. Data Breach Notification</h2>

        <h3>8.1 Notification Timeline</h3>
        <p>In the event of a Data Breach, the Processor shall:</p>
        <ul>
            <li>Notify the Controller without undue delay, and in any event within <strong>48 hours</strong> of becoming aware</li>
            <li>Provide all available information about the breach</li>
            <li>Cooperate with the Controller's investigation and response</li>
        </ul>

        <h3>8.2 Breach Information</h3>
        <p>The notification shall include, to the extent known:</p>
        <ul>
            <li>Nature of the breach and categories of Personal Data affected</li>
            <li>Approximate number of Data Subjects and records concerned</li>
            <li>Likely consequences of the breach</li>
            <li>Measures taken or proposed to address the breach</li>
            <li>Contact point for further information</li>
        </ul>

        <h3>8.3 Cooperation</h3>
        <p>The Processor shall:</p>
        <ul>
            <li>Take immediate steps to mitigate the effects of any breach</li>
            <li>Preserve evidence related to the breach</li>
            <li>Assist the Controller in notifying authorities and Data Subjects as required</li>
        </ul>

        <h2>9. International Data Transfers</h2>

        <h3>9.1 Transfer Mechanisms</h3>
        <p>For transfers of Personal Data outside the European Economic Area, the Processor shall use appropriate safeguards including:</p>
        <ul>
            <li>Standard Contractual Clauses (SCCs) as approved by the European Commission</li>
            <li>Transfers to countries with an adequacy decision</li>
            <li>Other approved mechanisms as they become available</li>
        </ul>

        <h3>9.2 Standard Contractual Clauses</h3>
        <p>Where SCCs apply:</p>
        <ul>
            <li>The parties agree to be bound by the SCCs as incorporated by reference</li>
            <li>Module Two (Controller to Processor) shall apply</li>
            <li>The optional clauses regarding onward transfer restrictions are selected</li>
        </ul>

        <h3>9.3 Transfer Impact Assessments</h3>
        <p>Upon request, the Processor shall cooperate with the Controller to conduct transfer impact assessments for Personal Data transferred to third countries.</p>

        <h2>10. Audits and Inspections</h2>

        <h3>10.1 Audit Rights</h3>
        <p>The Controller may audit the Processor's compliance with this DPA, subject to:</p>
        <ul>
            <li>Reasonable prior notice (minimum 30 days except for urgent matters)</li>
            <li>Confidentiality obligations regarding audit findings</li>
            <li>Limiting audits to once per year under normal circumstances</li>
        </ul>

        <h3>10.2 Audit Methods</h3>
        <p>Audits may be conducted through:</p>
        <ul>
            <li>Review of documentation and certifications</li>
            <li>Questionnaires and attestations</li>
            <li>On-site inspections (with reasonable limitations)</li>
            <li>Third-party audits at the Controller's expense</li>
        </ul>

        <h2>11. Data Deletion and Return</h2>

        <h3>11.1 Upon Termination</h3>
        <p>Upon termination of the service agreement, the Processor shall, at the Controller's choice:</p>
        <ul>
            <li>Return all Personal Data in a commonly used format</li>
            <li>Delete all Personal Data and existing copies</li>
            <li>Provide written certification of deletion upon request</li>
        </ul>

        <h3>11.2 Retention Exceptions</h3>
        <p>The Processor may retain Personal Data to the extent required by applicable law, provided that:</p>
        <ul>
            <li>The Controller is informed of the retention requirement</li>
            <li>Personal Data is retained only for the required period</li>
            <li>Confidentiality and security obligations continue to apply</li>
        </ul>

        <h3>11.3 Deletion Timeline</h3>
        <p>Unless otherwise agreed or required by law, deletion shall be completed within <strong>30 days</strong> of termination.</p>

        <h2>12. Liability</h2>

        <h3>12.1 Allocation of Liability</h3>
        <p>Each party's liability under this DPA shall be subject to the limitations set forth in the Terms of Service, except that:</p>
        <ul>
            <li>Data protection fines are not subject to liability caps</li>
            <li>Indemnification applies for breaches of this DPA causing third-party claims</li>
        </ul>

        <h3>12.2 Indemnification</h3>
        <p>Each party agrees to indemnify the other for damages arising from its breach of this DPA or applicable data protection laws.</p>

        <h2>13. Term and Termination</h2>
        <p>This DPA shall remain in effect for the duration of the service agreement between the parties. Upon termination of the service agreement, this DPA shall automatically terminate, subject to the survival of data deletion obligations.</p>

        <h2>14. Amendments</h2>
        <p>This DPA may be amended:</p>
        <ul>
            <li>By mutual written agreement of the parties</li>
            <li>By the Processor to comply with changes in applicable law, with prior notice to the Controller</li>
        </ul>

        <h2>15. Contact Information</h2>
        <div class="highlight">
            <strong>Ayrto Engineering</strong><br>
            Data Protection Inquiries: <a href="mailto:dpo@ayrto.dev">dpo@ayrto.dev</a><br>
            Legal Department: <a href="mailto:legal@ayrto.dev">legal@ayrto.dev</a>
        </div>

        <div class="annex">
            <h4>ANNEX A: Description of Processing</h4>
            <table>
                <tr>
                    <th>Element</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>Categories of Data Subjects</td>
                    <td>Customer's end users, employees, contractors, or other individuals whose data is indexed</td>
                </tr>
                <tr>
                    <td>Categories of Personal Data</td>
                    <td>File metadata (names, paths, timestamps), file contents (as submitted for indexing), user identifiers, IP addresses</td>
                </tr>
                <tr>
                    <td>Special Categories (if any)</td>
                    <td>Only as contained in Customer's indexed files; Customer is responsible for lawful basis</td>
                </tr>
                <tr>
                    <td>Processing Operations</td>
                    <td>Collection, storage, indexing, search, retrieval, analysis, deletion</td>
                </tr>
                <tr>
                    <td>Duration</td>
                    <td>Duration of service agreement plus retention period</td>
                </tr>
            </table>
        </div>

        <div class="annex">
            <h4>ANNEX B: Authorized Sub-processors</h4>
            <table>
                <tr>
                    <th>Sub-processor</th>
                    <th>Purpose</th>
                    <th>Location</th>
                </tr>
                <tr>
                    <td>Railway, Inc.</td>
                    <td>Cloud infrastructure hosting</td>
                    <td>United States</td>
                </tr>
                <tr>
                    <td>Stripe, Inc.</td>
                    <td>Payment processing</td>
                    <td>United States</td>
                </tr>
                <tr>
                    <td>Resend, Inc.</td>
                    <td>Transactional email delivery</td>
                    <td>United States</td>
                </tr>
            </table>
            <p>For the current list of Sub-processors, contact <a href="mailto:dpo@ayrto.dev">dpo@ayrto.dev</a>.</p>
        </div>

        <div class="annex">
            <h4>ANNEX C: Technical and Organizational Measures</h4>
            <p>The Processor implements the following measures:</p>
            <ul>
                <li><strong>Pseudonymization and Encryption:</strong> AES-256 encryption at rest, TLS 1.3 in transit</li>
                <li><strong>Confidentiality:</strong> Access controls, authentication, authorization</li>
                <li><strong>Integrity:</strong> Input validation, audit logging, change management</li>
                <li><strong>Availability:</strong> Redundant infrastructure, automated backups, disaster recovery</li>
                <li><strong>Resilience:</strong> Load balancing, failover systems, regular testing</li>
                <li><strong>Restoration:</strong> Point-in-time recovery, documented procedures</li>
                <li><strong>Testing:</strong> Regular security assessments, penetration testing</li>
            </ul>
        </div>

        <div class="footer">
            <p>&copy; 2026 Ayrto Engineering. All rights reserved.</p>
            <p>IndexerAPI is a trademark of Ayrto Engineering.</p>
        </div>
    </div>
</body>
</html>
"""

def get_data_processing_agreement() -> str:
    """Return the Data Processing Agreement HTML content."""
    return DATA_PROCESSING_AGREEMENT
